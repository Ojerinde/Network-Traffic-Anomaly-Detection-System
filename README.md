# Network Traffic Anomaly Detection System

## Overview

This project presents a machine learning–based system for detecting anomalous network traffic patterns. It supports both supervised and unsupervised approaches and is intended for use in cybersecurity scenarios such as intrusion detection, denial-of-service (DoS) mitigation, and traffic monitoring. The system is implemented in Python using the NSL-KDD dataset and includes a full pipeline: preprocessing, training, evaluation, and visualization.

## Objectives

- **Develop an automated detection system** capable of identifying abnormal traffic behavior in near real-time.
- **Compare learning strategies** by evaluating supervised (Random Forest) and unsupervised (Isolation Forest) models.
- **Ensure scalability and modularity** to accommodate evolving datasets and future model enhancements.

---

## Methodology

### Machine Learning Approaches

#### Random Forest (Supervised)

Random Forest builds an ensemble of decision trees trained on different subsets of the data. Each tree selects features based on **information gain**, a metric that quantifies the reduction in entropy:

$$
\text{Information Gain}(S, A) = H(S) - \sum_v \frac{|S_v|}{|S|} H(S_v)
$$

- $H(S) = -\sum p_i \log_2 p_i$ measures uncertainty within dataset $S$.
- Feature $A$ is selected when it results in a measurable entropy reduction across subsets $S_v$.

#### Isolation Forest (Unsupervised)

Isolation Forest identifies anomalies by randomly partitioning the dataset. Anomalies require fewer splits to isolate. The expected path length of an instance $x$ is used to assign anomaly scores:

$$
E(h(x)) = c(n) \cdot 2^{-\frac{E(h(x))}{c(n)}}
$$

- $h(x)$: Path length to isolate point $x$
- $c(n)$: Average path length in a binary search tree
- Shorter paths correspond to anomalous behavior

---

### Supporting Concepts

- **Entropy**: Used in both classification and anomaly scoring, calculated as

  $$
  H(X) = -\sum p(x) \log_2 p(x)
  $$

- **Mutual Information**: Used during feature selection to quantify shared information between a feature $X$ and the label $Y$:

  $$
  I(X;Y) = \sum_x \sum_y p(x,y) \log_2 \left( \frac{p(x,y)}{p(x)p(y)} \right)
  $$

---

## Implementation Details

### Core Components

1. **Data Loader (`utils/data_loader.py`)**
   Loads and preprocesses the NSL-KDD dataset.

2. **Preprocessing (`utils/preprocessing.py`)**
   Applies label encoding, standardization, and feature transformation.

3. **Model Training**

   - `run_supervised.py`: Random Forest (`n_estimators=100`, `max_depth=10`)
   - `run_unsupervised.py`: Isolation Forest (`contamination=0.1`)

4. **Evaluation (`utils/evaluate_models.py`)**
   Computes accuracy, precision, recall, F1-score (supervised), and anomaly detection rates (unsupervised).

5. **Visualization (`utils/visualizer.py`)**
   Generates performance plots using Matplotlib and Seaborn.

6. **Orchestration (`main.py`)**
   Runs the entire pipeline with a single command.

---

### Network Features

| Feature              | Description                   | Distribution                   |
| -------------------- | ----------------------------- | ------------------------------ |
| `packet_size`        | Packet byte size              | $\sim N(\mu_1, \sigma_1^2)$    |
| `flow_duration`      | Duration of network flow      | $\sim \text{Exp}(\lambda)$     |
| `packets_per_second` | Packet rate                   | $\sim N(\mu_2, \sigma_2^2)$    |
| `bytes_per_second`   | Bandwidth utilization         | $\sim N(\mu_3, \sigma_3^2)$    |
| `tcp_flags`          | Flag combinations             | $\sim \text{Poisson}(\lambda)$ |
| `port_number`        | Source/destination ports      | Categorical                    |
| `protocol`           | Protocol type (e.g. TCP, UDP) | Categorical                    |

> Anomalous data is generated by shifting the mean:
> $X_{\text{anomaly}} \sim N(\mu + k\sigma, \sigma^2), k > 2$

---

## Installation

### Requirements

- Python 3.8+
- Libraries listed in `requirements.txt`

### Setup

```bash
pip install -r requirements.txt
python main.py --mode both
```

---

## Performance Summary

### Supervised: Random Forest

| Class        | Precision | Recall | F1-Score | Samples |
| ------------ | --------- | ------ | -------- | ------- |
| Attack       | 0.94      | 0.60   | 0.73     | 22,531  |
| Normal       | 0.55      | 0.93   | 0.69     | 11,863  |
| **Accuracy** | **0.71**  |        |          |         |

- High attack precision reduces false positives
- Lower recall suggests some attack types remain undetected

### Unsupervised: Isolation Forest

- Anomaly Detection Rate: 49%
- Contamination parameter: 0.1 (assumes 10% anomalies)
- Suitable for detecting unknown or unseen attack patterns

---

## Visual Results

| Visualization                         | Description                           |
| ------------------------------------- | ------------------------------------- |
| `supervised_performance_detailed.png` | Class-wise metrics for Random Forest  |
| `confusion_matrix.png`                | Heatmap of classification results     |
| `class_distribution_analysis.png`     | Actual vs. predicted label ratios     |
| `unsupervised_analysis.png`           | Isolation Forest anomaly distribution |
| `model_comparison_analysis.png`       | Side-by-side performance comparison   |

---

## Observations

### Strengths

- Achieved high precision (94%) for detecting malicious traffic
- High recall (93%) for normal traffic
- Modular and extensible architecture
- Supports both labeled and unlabeled data scenarios

### Limitations

- 60% recall for attack traffic leaves room for improvement
- Class imbalance (65.5% attack, 34.5% normal) impacted model performance
- Additional tuning and resampling methods may improve detection

---

## Applications

- **Intrusion Detection**: Detects abnormal access patterns and misuse
- **DDoS Mitigation**: Flags potential flooding behaviors
- **Malware Detection**: Identifies suspicious traffic patterns
- **Data Exfiltration Monitoring**: Tracks large or unexpected transfers

---

## Complexity

| Algorithm        | Time Complexity (Training/Inference) |
| ---------------- | ------------------------------------ |
| Random Forest    | $O(n \log n)$                        |
| Isolation Forest | $O(n \log n)$                        |

---

## Project Structure

```
network-traffic-anomaly-detection/
├── utils/
│   ├── run_supervised.py
│   ├── run_unsupervised.py
│   ├── data_loader.py
│   ├── preprocessing.py
│   ├── evaluate_models.py
│   └── visualizer.py
├── main.py
├── models/
│   ├── supervised_rf.pkl
│   ├── unsupervised_if.pkl
│   └── scaler.pkl
├── visuals/
├── requirements.txt
└── README.md
```

---

## References

1. Breiman, L. (2001). _Random Forests_. _Machine Learning_, 45(1), 5–32. [https://doi.org/10.1023/A:1010933404324](https://doi.org/10.1023/A:1010933404324)
2. Liu, F. T., Ting, K. M., & Zhou, Z. H. (2008). _Isolation Forest_. _ICDM_. [https://doi.org/10.1109/ICDM.2008.17](https://doi.org/10.1109/ICDM.2008.17)
3. [Scikit-learn documentation](https://scikit-learn.org/stable/)
